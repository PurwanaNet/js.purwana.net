<!doctype html>
<html lang="id" data-theme-enabled="1">
 <head> 
  <script>window.currentUser = null;</script> 
  <script>window.shopCurrency = "EUR";</script> 
  <script>window.localCurrency = "EUR";</script> 
  <script>window.countryCode = "us";</script> 
  <script>window.rateShopTo = {"EUR":1,"USD":1.0716494077529548,"AMD":417.60490643964846};</script> 
  <title itemprop="name">Catastrophic backtracking</title> 
  <link href="pack/styles.a7ab594e74e7a233e3dd.css" rel="stylesheet"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"> 
  <meta name="apple-mobile-web-app-capable" content="yes"> 
  <!-- chrome autotranslate is enabled only for "en" main version--> 
  <meta name="google" content="notranslate"> 
  <script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script> 
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic" rel="stylesheet"> 
  <link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"> 
  <link rel="canonical" href="regexp-catastrophic-backtracking.html"> 
  <meta name="msapplication-TileColor" content="#222A2C"> 
  <meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"> 
  <link rel="icon" href="img/favicon/favicon.png"> 
  <meta itemprop="image" content="https://id.javascript.info/img/site_preview_en_512x512.png"> 
  <meta property="og:title" content="Catastrophic backtracking"> 
  <meta property="og:image" content="https://id.javascript.info/img/site_preview_en_1200x630.png"> 
  <meta property="og:image:type" content="image/png"> 
  <meta property="og:image:width" content="1200"> 
  <meta property="og:image:height" content="630"> 
  <meta property="fb:admins" content="100001562528165"> 
  <meta name="twitter:card" content="summary"> 
  <meta name="twitter:title" content="Catastrophic backtracking"> 
  <meta name="twitter:site" content="@iliakan"> 
  <meta name="twitter:creator" content="@iliakan"> 
  <meta name="twitter:image" content="https://id.javascript.info/img/site_preview_en_512x512.png"> 
  <link rel="prev" href="regexp-lookahead-lookbehind.html"> 
  <link rel="next" href="regexp-sticky.html"> 
  <script>window.GA_ID = "UA-2056213-15";</script> 
  <script>window.YANDEX_METRIKA_ID = 32184394;</script> 
  <script>window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";</script> 
  <script src="pack/init.4910a4963629a5955eb6.js"></script> 
  <script src="pack/head.ff7d075915f5367566f2.js" defer></script> 
  <meta property="og:title" content="Catastrophic backtracking"> 
  <meta property="og:type" content="article"> 
  <script src="pack/tutorial.f0717d796f690e0a6aaf.js" defer></script> 
  <script src="pack/footer.5b1695b27f7207cacf2f.js" defer></script> 
   
   
 </head> 
 <body class="no-icons"> 
  <script>window.fontTest();</script> 
  <div class="page-wrapper page-wrapper_sidebar_on"> 
   <!--[if IE]><div style="color:red;text-align:center">Maaf, Internet Explorer tidak didukung, harap gunakan browser yang lebih baru.</div><![endif]--> 
   <div class="sitetoolbar sitetoolbar_tutorial"> 
    <script>window.langs = [{"code":"ar","name":"Arabic"},{"code":"az","name":"Azerbaijani"},{"code":"bg","name":"Bulgarian"},{"code":"bn","name":"Bengali"},{"code":"bs","name":"Bosnian"},{"code":"ca","name":"Catalan"},{"code":"cs","name":"Czech"},{"code":"da","name":"Danish"},{"code":"de","name":"German"},{"code":"el","name":"Greek"},{"code":"en","name":"English"},{"code":"es","name":"Spanish"},{"code":"fa","name":"Persian (Farsi)"},{"code":"fi","name":"Finnish"},{"code":"fr","name":"French"},{"code":"he","name":"Hebrew"},{"code":"hi","name":"Hindi"},{"code":"hr","name":"Croatian"},{"code":"hu","name":"Hungarian"},{"code":"hy","name":"Armenian"},{"code":"id","name":"Indonesian"},{"code":"it","name":"Italian"},{"code":"ja","name":"Japanese"},{"code":"ka","name":"Georgian"},{"code":"kk","name":"Kazakh"},{"code":"km","name":"Central Khmer"},{"code":"ko","name":"Korean"},{"code":"ky","name":"Kyrgyz"},{"code":"lt","name":"Lithuanian"},{"code":"me","name":"Montenegrin"},{"code":"ml","name":"Malayalam"},{"code":"ms","name":"Malay"},{"code":"my","name":"Burmese"},{"code":"nl","name":"Dutch"},{"code":"no","name":"Norvegian"},{"code":"pa","name":"Punjabi"},{"code":"pl","name":"Polish"},{"code":"pt","name":"Portuguese"},{"code":"ro","name":"Romanian"},{"code":"ru","name":"Russian"},{"code":"si","name":"Sinhala"},{"code":"sk","name":"Slovak"},{"code":"sl","name":"Slovenian"},{"code":"sq","name":"Albanian"},{"code":"sr","name":"Serbian"},{"code":"ta","name":"Tamil"},{"code":"te","name":"Telugu"},{"code":"test","name":"Test"},{"code":"th","name":"Thai"},{"code":"tk","name":"Turkmen"},{"code":"tr","name":"Turkish"},{"code":"uk","name":"Ukrainian"},{"code":"ur","name":"Urdu"},{"code":"uz","name":"Uzbek"},{"code":"v2","name":"v2"},{"code":"vi","name":"Vietnamese"},{"code":"zh-hant","name":"Chinese Traditional"},{"code":"zh","name":"Chinese"}];</script> 
    <script>window.lang = "id";</script> 
    <div class="sitetoolbar__content"> 
     <div class="sitetoolbar__logo-wrap"> 
      <br> 
      <a class="sitetoolbar__link sitetoolbar__link_logo" href="index.html"><h1>Teman Javascript</h1></a> 
     </div> 
     <div class="sitetoolbar__nav-toggle-wrap"> 
      <button class="sitetoolbar__nav-toggle" type="button"></button> 
     </div> 
     <nav class="sitetoolbar__sections"> 
      <ul class="sitetoolbar__sections-list"></ul> 
     </nav> 
     <div class="sitetoolbar__theme-switcher"> 
      <div class="theme-changer"> 
       <label class="theme-changer__label" for="theme-changer-input" data-tooltip="Change theme"><input class="theme-changer__input" type="checkbox" id="theme-changer-input" data-theme-changer="data-theme-changer"><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span></label> 
      </div> 
     </div> 
    </div> 
    <div class="tablet-menu"> 
     <div class="tablet-menu__line"> 
      <div class="tablet-menu__content"> 
      </div> 
     </div> 
     <div class="tablet-menu__line"> 
      <div class="tablet-menu__content"> 
      </div> 
     </div> 
     <div class="tablet-menu__line"> 
      <div class="tablet-menu__content"> 
       <div class="theme-changer theme-changer_tablet-menu theme-changer_has-label"> 
        <label class="theme-changer__label" for="theme-changer-input-tablet" data-tooltip="Change theme"><input class="theme-changer__input" type="checkbox" id="theme-changer-input-tablet" data-theme-changer="data-theme-changer"><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span><span class="theme-changer__label-text theme-changer__label-text_light-theme">Light theme</span><span class="theme-changer__label-text theme-changer__label-text_dark-theme">Dark theme</span></label> 
       </div> 
      </div> 
     </div> 
     <div class="tablet-menu__line"> 
      <div class="tablet-menu__content"> 
       <div class="share-icons"> 
        <span class="share-icons__title">Bagikan</span> 
        <a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Fjs.purwana.net%2Fregexp-catastrophic-backtracking" rel="nofollow"></a> 
        <a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjs.purwana.net%2Fregexp-catastrophic-backtracking" rel="nofollow"></a> 
       </div> 
      </div> 
     </div> 
     <div class="tablet-menu__line"> 
      <div class="tablet-menu__content"> 
      </div> 
     </div> 
    </div> 
    <progress class="tutorial-progress" data-sticky value="15" max="17" data-tooltip="Pelajaran 15 dari 17"></progress> 
   </div> 
   <div class="page page_sidebar_on page_inner_padding"> 
    <script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");let e=document.querySelector(".page-wrapper");e&&e.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")});</script> 
    <div class="page__inner"> 
     <main class="main main_width-limit"> 
      <header class="main__header"> 
       <div class="main__header-inner"> 
        <div class="main__header-group"> 
         <ol class="breadcrumbs"> 
          <li class="breadcrumbs__item breadcrumbs__item_home"><a class="breadcrumbs__link" href="index.html"><span class="breadcrumbs__hidden-text">Tutorial</span></a></li> 
          <li class="breadcrumbs__item" id="breadcrumb-1"><a class="breadcrumbs__link" href="regular-expressions.html"><span>Regular expressions</span></a></li> 
          <script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorial","item":"https://id.javascript.info/"},{"@type":"ListItem","position":2,"name":"Regular expressions","item":"https://id.javascript.info/regular-expressions"}]}</script> 
         </ol> 
         <div class="updated-at" data-tooltip="Terakhir diperbarui pada 15 Mei 2021"> 
          <div class="updated-at__content">
            15 Mei 2021 
          </div> 
         </div> 
        </div> 
        <div class="notification notification_message notification_warning notification_article"> 
         <div class="notification__content">
           Materi ini hanya tersedia dalam bahasa berikut: 
          <a href="https://ar.javascript.info/regexp-catastrophic-backtracking">????????</a>, 
          <a href="https://javascript.info/regexp-catastrophic-backtracking">English</a>, 
          <a href="https://es.javascript.info/regexp-catastrophic-backtracking">Espa??ol</a>, 
          <a href="https://fr.javascript.info/regexp-catastrophic-backtracking">Fran??ais</a>, 
          <a href="https://ja.javascript.info/regexp-catastrophic-backtracking">?????????</a>, 
          <a href="https://ko.javascript.info/regexp-catastrophic-backtracking">?????????</a>, 
          <a href="https://learn.javascript.ru/regexp-catastrophic-backtracking">??????????????</a>, 
          <a href="https://tr.javascript.info/regexp-catastrophic-backtracking">T??rk??e</a>, 
          <a href="https://zh.javascript.info/regexp-catastrophic-backtracking">????????????</a>. Tolong, menerjemahkan ke dalam 
          <strong>Indonesia</strong>. 
         </div> 
        </div> 
        <h1 class="main__header-title">Catastrophic backtracking</h1> 
       </div> 
      </header> 
      <style>
.gsc-control {
    width: 100%;
}
</style> 
      <script async src="https://cse.google.com/cse.js?cx=670735444dc5843cf"></script> 
      <div class="gcse-search"></div> 
      <div class="content"> 
       <article class="formatted" itemscope itemtype="http://schema.org/TechArticle"> 
        <meta itemprop="name" content="Catastrophic backtracking"> 
        <div itemprop="author" itemscope itemtype="http://schema.org/Person"> 
         <meta itemprop="email" content="iliakan@gmail.com"> 
         <meta itemprop="name" content="Ilya Kantor"> 
        </div> 
        <div itemprop="articleBody"> 
         <p>Some regular expressions are looking simple, but can execute a veeeeeery long time, and even ???hang??? the JavaScript engine.</p> 
         <p>Sooner or later most developers occasionally face such behavior. The typical symptom ??? a regular expression works fine sometimes, but for certain strings it ???hangs???, consuming 100% of CPU.</p> 
         <p>In such case a web-browser suggests to kill the script and reload the page. Not a good thing for sure.</p> 
         <p>For server-side JavaScript such a regexp may hang the server process, that???s even worse. So we definitely should take a look at it.</p> 
         <h2><a class="main__anchor" name="example" href="regexp-catastrophic-backtracking.html#example">Example</a></h2> 
         <p>Let???s say we have a string, and we???d like to check if it consists of words <code class="pattern">\w+</code> with an optional space <code class="pattern">\s?</code> after each.</p> 
         <p>An obvious way to construct a regexp would be to take a word followed by an optional space <code class="pattern">\w+\s?</code> and then repeat it with <code>*</code>.</p> 
         <p>That leads us to the regexp <code class="pattern">^(\w+\s?)*$</code>, it specifies zero or more such words, that start at the beginning <code class="pattern">^</code> and finish at the end <code class="pattern">$</code> of the line.</p> 
         <p>In action:</p> 
         <div id="ebd61mtdr1" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>let regexp = /^(\w+\s?)*$/;

alert( regexp.test("A good string") ); // true
alert( regexp.test("Bad characters: $@#") ); // false</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>The regexp seems to work. The result is correct. Although, on certain strings it takes a lot of time. So long that JavaScript engine ???hangs??? with 100% CPU consumption.</p> 
         <p>If you run the example below, you probably won???t see anything, as JavaScript will just ???hang???. A web-browser will stop reacting on events, the UI will stop working (most browsers allow only scrolling). After some time it will suggest to reload the page. So be careful with this:</p> 
         <div id="i9cwwvgu41" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>let regexp = /^(\w+\s?)*$/;
let str = "An input string that takes a long time or even makes this regexp hang!";

// will take a very long time
alert( regexp.test(str) );</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>To be fair, let???s note that some regular expression engines can handle such a search effectively, for example V8 engine version starting from 8.8 can do that (so Google Chrome 88 doesn???t hang here), while Firefox browser does hang.</p> 
         <h2><a class="main__anchor" name="simplified-example" href="regexp-catastrophic-backtracking.html#simplified-example">Simplified example</a></h2> 
         <p>What???s the matter? Why does the regular expression hang?</p> 
         <p>To understand that, let???s simplify the example: remove spaces <code class="pattern">\s?</code>. Then it becomes <code class="pattern">^(\w+)*$</code>.</p> 
         <p>And, to make things more obvious, let???s replace <code class="pattern">\w</code> with <code class="pattern">\d</code>. The resulting regular expression still hangs, for instance:</p> 
         <div id="c0crq221hm" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>let regexp = /^(\d+)*$/;

let str = "012345678901234567890123456789z";

// will take a very long time (careful!)
alert( regexp.test(str) );</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>So what???s wrong with the regexp?</p> 
         <p>First, one may notice that the regexp <code class="pattern">(\d+)*</code> is a little bit strange. The quantifier <code class="pattern">*</code> looks extraneous. If we want a number, we can use <code class="pattern">\d+</code>.</p> 
         <p>Indeed, the regexp is artificial; we got it by simplifying the previous example. But the reason why it is slow is the same. So let???s understand it, and then the previous example will become obvious.</p> 
         <p>What happens during the search of <code class="pattern">^(\d+)*$</code> in the line <code class="subject">123456789z</code> (shortened a bit for clarity, please note a non-digit character <code class="subject">z</code> at the end, it???s important), why does it take so long?</p> 
         <p>Here???s what the regexp engine does:</p> 
         <ol> 
          <li> <p>First, the regexp engine tries to find the content of the parentheses: the number <code class="pattern">\d+</code>. The plus <code class="pattern">+</code> is greedy by default, so it consumes all digits:</p> 
           <div id="yuiz071unv" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>\d+.......
(123456789)z</code></pre> 
             </div> 
            </div> 
           </div><p>After all digits are consumed, <code class="pattern">\d+</code> is considered found (as <code class="match">123456789</code>).</p> <p>Then the star quantifier <code class="pattern">(\d+)*</code> applies. But there are no more digits in the text, so the star doesn???t give anything.</p> <p>The next character in the pattern is the string end <code class="pattern">$</code>. But in the text we have <code class="subject">z</code> instead, so there???s no match:</p> 
           <div id="eyk86rpdfa" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>           X
\d+........$
(123456789)z</code></pre> 
             </div> 
            </div> 
           </div></li> 
          <li> <p>As there???s no match, the greedy quantifier <code class="pattern">+</code> decreases the count of repetitions, backtracks one character back.</p> <p>Now <code class="pattern">\d+</code> takes all digits except the last one (<code class="match">12345678</code>):</p> 
           <div id="6th65mrqtd" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>\d+.......
(12345678)9z</code></pre> 
             </div> 
            </div> 
           </div></li> 
          <li> <p>Then the engine tries to continue the search from the next position (right after <code class="match">12345678</code>).</p> <p>The star <code class="pattern">(\d+)*</code> can be applied ??? it gives one more match of <code class="pattern">\d+</code>, the number <code class="match">9</code>:</p> 
           <div id="eun7jn42pa" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>\d+.......\d+
(12345678)(9)z</code></pre> 
             </div> 
            </div> 
           </div><p>The engine tries to match <code class="pattern">$</code> again, but fails, because it meets <code class="subject">z</code> instead:</p> 
           <div id="6ts25839ah" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>             X
\d+.......\d+
(12345678)(9)z</code></pre> 
             </div> 
            </div> 
           </div></li> 
          <li> <p>There???s no match, so the engine will continue backtracking, decreasing the number of repetitions. Backtracking generally works like this: the last greedy quantifier decreases the number of repetitions until it reaches the minimum. Then the previous greedy quantifier decreases, and so on.</p> <p>All possible combinations are attempted. Here are their examples.</p> <p>The first number <code class="pattern">\d+</code> has 7 digits, and then a number of 2 digits:</p> 
           <div id="kiw7tjjh8f" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>             X
\d+......\d+
(1234567)(89)z</code></pre> 
             </div> 
            </div> 
           </div><p>The first number has 7 digits, and then two numbers of 1 digit each:</p> 
           <div id="mu9apxzgdq" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>               X
\d+......\d+\d+
(1234567)(8)(9)z</code></pre> 
             </div> 
            </div> 
           </div><p>The first number has 6 digits, and then a number of 3 digits:</p> 
           <div id="4rln8yk3hg" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>             X
\d+.......\d+
(123456)(789)z</code></pre> 
             </div> 
            </div> 
           </div><p>The first number has 6 digits, and then 2 numbers:</p> 
           <div id="9n7qotrkov" data-trusted="1" class="code-example"> 
            <div class="codebox code-example__codebox"> 
             <div class="codebox__code" data-code="1"> 
              <pre class="line-numbers language-none"><code>               X
\d+.....\d+ \d+
(123456)(78)(9)z</code></pre> 
             </div> 
            </div> 
           </div><p>???And so on.</p> </li> 
         </ol> 
         <p>There are many ways to split a sequence of digits <code>123456789</code> into numbers. To be precise, there are <code>2<sup>n</sup>-1</code>, where <code>n</code> is the length of the sequence.</p> 
         <ul> 
          <li>For <code>123456789</code> we have <code>n=9</code>, that gives 511 combinations.</li> 
          <li>For a longer sequence with <code>n=20</code> there are about one million (1048575) combinations.</li> 
          <li>For <code>n=30</code> ??? a thousand times more (1073741823 combinations).</li> 
         </ul> 
         <p>Trying each of them is exactly the reason why the search takes so long.</p> 
         <h2><a class="main__anchor" name="back-to-words-and-strings" href="regexp-catastrophic-backtracking.html#back-to-words-and-strings">Back to words and strings</a></h2> 
         <p>The similar thing happens in our first example, when we look for words by pattern <code class="pattern">^(\w+\s?)*$</code> in the string <code class="subject">An input that hangs!</code>.</p> 
         <p>The reason is that a word can be represented as one <code class="pattern">\w+</code> or many:</p> 
         <div id="hu73c7ne51" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-none"><code>(input)
(inpu)(t)
(inp)(u)(t)
(in)(p)(ut)
...</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>For a human, it???s obvious that there may be no match, because the string ends with an exclamation sign <code>!</code>, but the regular expression expects a wordly character <code class="pattern">\w</code> or a space <code class="pattern">\s</code> at the end. But the engine doesn???t know that.</p> 
         <p>It tries all combinations of how the regexp <code class="pattern">(\w+\s?)*</code> can ???consume??? the string, including variants with spaces <code class="pattern">(\w+\s)*</code> and without them <code class="pattern">(\w+)*</code> (because spaces <code class="pattern">\s?</code> are optional). As there are many such combinations (we???ve seen it with digits), the search takes a lot of time.</p> 
         <p>What to do?</p> 
         <p>Should we turn on the lazy mode?</p> 
         <p>Unfortunately, that won???t help: if we replace <code class="pattern">\w+</code> with <code class="pattern">\w+?</code>, the regexp will still hang. The order of combinations will change, but not their total count.</p> 
         <p>Some regular expression engines have tricky tests and finite automations that allow to avoid going through all combinations or make it much faster, but most engines don???t, and it doesn???t always help.</p> 
         <h2><a class="main__anchor" name="how-to-fix" href="regexp-catastrophic-backtracking.html#how-to-fix">How to fix?</a></h2> 
         <p>There are two main approaches to fixing the problem.</p> 
         <p>The first is to lower the number of possible combinations.</p> 
         <p>Let???s make the space non-optional by rewriting the regular expression as <code class="pattern">^(\w+\s)*\w*$</code> ??? we???ll look for any number of words followed by a space <code class="pattern">(\w+\s)*</code>, and then (optionally) a final word <code class="pattern">\w*</code>.</p> 
         <p>This regexp is equivalent to the previous one (matches the same) and works well:</p> 
         <div id="4ertpmkjzw" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>let regexp = /^(\w+\s)*\w*$/;
let str = "An input string that takes a long time or even makes this regex hang!";

alert( regexp.test(str) ); // false</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>Why did the problem disappear?</p> 
         <p>That???s because now the space is mandatory.</p> 
         <p>The previous regexp, if we omit the space, becomes <code class="pattern">(\w+)*</code>, leading to many combinations of <code>\w+</code> within a single word</p> 
         <p>So <code class="subject">input</code> could be matched as two repetitions of <code class="pattern">\w+</code>, like this:</p> 
         <div id="yczdulpquo" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-none"><code>\w+  \w+
(inp)(ut)</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>The new pattern is different: <code class="pattern">(\w+\s)*</code> specifies repetitions of words followed by a space! The <code class="subject">input</code> string can???t be matched as two repetitions of <code class="pattern">\w+\s</code>, because the space is mandatory.</p> 
         <p>The time needed to try a lot of (actually most of) combinations is now saved.</p> 
         <h2><a class="main__anchor" name="preventing-backtracking" href="regexp-catastrophic-backtracking.html#preventing-backtracking">Preventing backtracking</a></h2> 
         <p>It???s not always convenient to rewrite a regexp though. In the example above it was easy, but it???s not always obvious how to do it.</p> 
         <p>Besides, a rewritten regexp is usually more complex, and that???s not good. Regexps are complex enough without extra efforts.</p> 
         <p>Luckily, there???s an alternative approach. We can forbid backtracking for the quantifier.</p> 
         <p>The root of the problem is that the regexp engine tries many combinations that are obviously wrong for a human.</p> 
         <p>E.g. in the regexp <code class="pattern">(\d+)*$</code> it???s obvious for a human, that <code class="pattern">+</code> shouldn???t backtrack. If we replace one <code class="pattern">\d+</code> with two separate <code class="pattern">\d+\d+</code>, nothing changes:</p> 
         <div id="3xenabghlp" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-none"><code>\d+........
(123456789)!

\d+...\d+....
(1234)(56789)!</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>And in the original example <code class="pattern">^(\w+\s?)*$</code> we may want to forbid backtracking in <code class="pattern">\w+</code>. That is: <code class="pattern">\w+</code> should match a whole word, with the maximal possible length. There???s no need to lower the repetitions count in <code class="pattern">\w+</code> or to split it into two words <code class="pattern">\w+\w+</code> and so on.</p> 
         <p>Modern regular expression engines support possessive quantifiers for that. Regular quantifiers become possessive if we add <code class="pattern">+</code> after them. That is, we use <code class="pattern">\d++</code> instead of <code class="pattern">\d+</code> to stop <code class="pattern">+</code> from backtracking.</p> 
         <p>Possessive quantifiers are in fact simpler than ???regular??? ones. They just match as many as they can, without any backtracking. The search process without backtracking is simpler.</p> 
         <p>There are also so-called ???atomic capturing groups??? ??? a way to disable backtracking inside parentheses.</p> 
         <p>???But the bad news is that, unfortunately, in JavaScript they are not supported.</p> 
         <p>We can emulate them though using a ???lookahead transform???.</p> 
         <h3><a class="main__anchor" name="lookahead-to-the-rescue" href="regexp-catastrophic-backtracking.html#lookahead-to-the-rescue">Lookahead to the rescue!</a></h3> 
         <p>So we???ve come to real advanced topics. We???d like a quantifier, such as <code class="pattern">+</code> not to backtrack, because sometimes backtracking makes no sense.</p> 
         <p>The pattern to take as many repetitions of <code class="pattern">\w</code> as possible without backtracking is: <code class="pattern">(?=(\w+))\1</code>. Of course, we could take another pattern instead of <code class="pattern">\w</code>.</p> 
         <p>That may seem odd, but it???s actually a very simple transform.</p> 
         <p>Let???s decipher it:</p> 
         <ul> 
          <li>Lookahead <code class="pattern">?=</code> looks forward for the longest word <code class="pattern">\w+</code> starting at the current position.</li> 
          <li>The contents of parentheses with <code class="pattern">?=...</code> isn???t memorized by the engine, so wrap <code class="pattern">\w+</code> into parentheses. Then the engine will memorize their contents</li> 
          <li>???And allow us to reference it in the pattern as <code class="pattern">\1</code>.</li> 
         </ul> 
         <p>That is: we look ahead ??? and if there???s a word <code class="pattern">\w+</code>, then match it as <code class="pattern">\1</code>.</p> 
         <p>Why? That???s because the lookahead finds a word <code class="pattern">\w+</code> as a whole and we capture it into the pattern with <code class="pattern">\1</code>. So we essentially implemented a possessive plus <code class="pattern">+</code> quantifier. It captures only the whole word <code class="pattern">\w+</code>, not a part of it.</p> 
         <p>For instance, in the word <code class="subject">JavaScript</code> it may not only match <code class="match">Java</code>, but leave out <code class="match">Script</code> to match the rest of the pattern.</p> 
         <p>Here???s the comparison of two patterns:</p> 
         <div id="eumzln53gh" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>alert( "JavaScript".match(/\w+Script/)); // JavaScript
alert( "JavaScript".match(/(?=(\w+))\1Script/)); // null</code></pre> 
           </div> 
          </div> 
         </div> 
         <ol> 
          <li>In the first variant <code class="pattern">\w+</code> first captures the whole word <code class="subject">JavaScript</code> but then <code class="pattern">+</code> backtracks character by character, to try to match the rest of the pattern, until it finally succeeds (when <code class="pattern">\w+</code> matches <code class="match">Java</code>).</li> 
          <li>In the second variant <code class="pattern">(?=(\w+))</code> looks ahead and finds the word <code class="subject">JavaScript</code>, that is included into the pattern as a whole by <code class="pattern">\1</code>, so there remains no way to find <code class="subject">Script</code> after it.</li> 
         </ol> 
         <p>We can put a more complex regular expression into <code class="pattern">(?=(\w+))\1</code> instead of <code class="pattern">\w</code>, when we need to forbid backtracking for <code class="pattern">+</code> after it.</p> 
         <div class="important important_smart"> 
          <div class="important__header"> 
           <span class="important__type">Tolong dicatat:</span> 
          </div> 
          <div class="important__content"> 
           <p>There???s more about the relation between possessive quantifiers and lookahead in articles <a href="http://instanceof.me/post/52245507631/regex-emulate-atomic-grouping-with-lookahead">Regex: Emulate Atomic Grouping (and Possessive Quantifiers) with LookAhead</a> and <a href="http://blog.stevenlevithan.com/archives/mimic-atomic-groups">Mimicking Atomic Groups</a>.</p> 
          </div> 
         </div> 
         <p>Let???s rewrite the first example using lookahead to prevent backtracking:</p> 
         <div id="h75vusee2c" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>let regexp = /^((?=(\w+))\2\s?)*$/;

alert( regexp.test("A good string") ); // true

let str = "An input string that takes a long time or even makes this regex hang!";

alert( regexp.test(str) ); // false, works and fast!</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>Here <code class="pattern">\2</code> is used instead of <code class="pattern">\1</code>, because there are additional outer parentheses. To avoid messing up with the numbers, we can give the parentheses a name, e.g. <code class="pattern">(?&lt;word&gt;\w+)</code>.</p> 
         <div id="gpbtgh1a79" data-trusted="1" class="code-example"> 
          <div class="codebox code-example__codebox"> 
           <div class="toolbar codebox__toolbar"> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="jalankan" data-action="run" class="toolbar__button toolbar__button_run"></a> 
            </div> 
            <div class="toolbar__tool"> 
             <a href="regexp-catastrophic-backtracking.html#" title="buka pada sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a> 
            </div> 
           </div> 
           <div class="codebox__code" data-code="1"> 
            <pre class="line-numbers language-javascript"><code>// parentheses are named ?&lt;word&gt;, referenced as \k&lt;word&gt;
let regexp = /^((?=(?&lt;word&gt;\w+))\k&lt;word&gt;\s?)*$/;

let str = "An input string that takes a long time or even makes this regex hang!";

alert( regexp.test(str) ); // false

alert( regexp.test("A correct string") ); // true</code></pre> 
           </div> 
          </div> 
         </div> 
         <p>The problem described in this article is called ???catastrophic backtracking???.</p> 
         <p>We covered two ways how to solve it:</p> 
         <ul> 
          <li>Rewrite the regexp to lower the possible combinations count.</li> 
          <li>Prevent backtracking.</li> 
         </ul> 
        </div> 
       </article> 
      </div> 
      <div class="page__nav-wrap"> 
       <a class="page__nav page__nav_prev" href="regexp-lookahead-lookbehind.html" data-tooltip="Lookahead and lookbehind"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Pelajaran sebelumnya</span></a> 
       <a class="page__nav page__nav_next" href="regexp-sticky.html" data-tooltip="Sticky flag &quot;y&quot;, searching at position"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Pelajaran berikutnya</span></a> 
      </div> 
      <div class="article-tablet-foot tablet-only"> 
       <div class="article-tablet-foot__layout"> 
        <div class="share-icons"> 
         <span class="share-icons__title">Bagikan</span> 
         <a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Fjs.purwana.net%2Fregexp-catastrophic-backtracking" rel="nofollow"></a> 
         <a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjs.purwana.net%2Fregexp-catastrophic-backtracking" rel="nofollow"></a> 
        </div> 
        <div class="article-tablet-foot__map"> 
         <a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Peta tutorial</span></a> 
        </div> 
       </div> 
      </div> 
     </main> 
    </div> 
    <div class="sidebar page__sidebar sidebar sidebar_sticky-footer"> 
     <button class="sidebar__toggle" data-sidebar-toggle></button> 
     <div class="sidebar__inner"> 
      <div class="sidebar__content"> 
       <div class="sidebar__section"> 
        <h4 class="sidebar__section-title">Bab</h4> 
        <nav class="sidebar__navigation"> 
         <ul class="sidebar__navigation-links"> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regular-expressions.html">Regular expressions</a></li> 
         </ul> 
        </nav> 
       </div> 
       <div class="sidebar__section"> 
        <h4 class="sidebar__section-title">Navigasi pelajaran</h4> 
        <nav class="sidebar__navigation"> 
         <ul class="sidebar__navigation-links"> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regexp-catastrophic-backtracking.html#example">Example</a></li> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regexp-catastrophic-backtracking.html#simplified-example">Simplified example</a></li> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regexp-catastrophic-backtracking.html#back-to-words-and-strings">Back to words and strings</a></li> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regexp-catastrophic-backtracking.html#how-to-fix">How to fix?</a></li> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regexp-catastrophic-backtracking.html#preventing-backtracking">Preventing backtracking</a></li> 
         </ul> 
        </nav> 
       </div> 
       <div class="sidebar__section"> 
        <nav class="sidebar__navigation"> 
         <ul class="sidebar__navigation-links"> 
          <li class="sidebar__navigation-link"><a class="sidebar__link" href="regexp-catastrophic-backtracking.html#comments">komentar</a></li> 
         </ul> 
        </nav> 
       </div> 
       <div class="sidebar__section"> 
        <div class="sidebar__section-title">
          Bagikan 
        </div> 
        <a class="share share_tw sidebar__share" href="https://twitter.com/share?url=https%3A%2F%2Fjs.purwana.net%2Fregexp-catastrophic-backtracking" rel="nofollow"></a> 
        <a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fjs.purwana.net%2Fregexp-catastrophic-backtracking" rel="nofollow"></a> 
       </div> 
       <div class="sidebar__section"></div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="page-footer"> 
   <ul class="page-footer__list"> 
    <li class="page-footer__item page-footer__item_copy">??&nbsp;2007???2023&nbsp; Teman JS</li> 
    <li class="page-footer__item page-footer__item_about"><!--by <a href="https://wifi.purwana.net">klub wifi merdeka</a>--></li> 
    <li class="page-footer__item page-footer__item_contact"><!--built with <a href="https://angga.purwana.net" target="_blank">angga purwana</a>--></li> 
   </ul> 
  </div>  
 </body>
</html>